# 前端登录权限联调指南

## 1. 概述
本文档旨在指导前端开发人员如何对接更新后的登录接口，并利用返回的 `permissions` 字段实现基于权限的页面访问控制（RBAC）。

## 2. 接口变更说明
**接口地址**: `POST /api/user/login` (或对应网关地址)
**返回数据结构变更**:
在原有的返回结构中新增了 `permissions` 字段，该字段为一个字符串数组，包含当前用户所属角色拥有的所有权限键。

### 示例响应
```json
{
  "ok": true,
  "username": "admin",
  "fullName": "系统管理员",
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
  "roles": ["admin"],
  "permissions": [
    "auth:manage",
    "fault:diagnose",
    "cluster:list",
    "cluster:log",
    "cluster:op_log"
  ]
}
```

## 3. 权限键值表 (Permission Keys)
目前系统定义的权限键及其对应含义如下：

| 权限键 (Permission Key) | 功能描述 | 建议对应页面/模块 |
| :--- | :--- | :--- |
| `auth:manage` | 角色权限控制 | 用户管理、角色分配、权限配置页面 |
| `fault:diagnose` | 故障诊断 | 故障分析、AI 诊断建议模块 |
| `cluster:list` | 集群列表 | 集群状态看板、集群基础信息页面 |
| `cluster:log` | 集群日志 | HDFS/Yarn/HBase 等组件日志查询页面 |
| `cluster:op_log` | 集群操作日志 | 系统执行记录、审计日志查看页面 |

## 4. 前端实现建议

### 4.1 存储权限信息
建议在登录成功后，将 `permissions` 数组持久化存储到 `localStorage` 或全局状态管理（如 Vuex/Pinia 或 Redux）中。

### 4.2 路由守卫 (Route Guard)
在全局路由拦截器中，根据路由配置的 `meta.permission` 属性与用户拥有的 `permissions` 进行比对。

```javascript
// 示例：Vue Router 导航守卫
router.beforeEach((to, from, next) => {
  const userPermissions = store.getters.permissions; // 从全局状态获取
  
  if (to.meta.permission && !userPermissions.includes(to.meta.permission)) {
    // 如果用户没有该页面所需的权限，重定向到 403 页面
    next({ name: '403' });
  } else {
    next();
  }
});
```

### 4.3 按钮级控制
可以通过自定义指令（如 Vue 的 `v-permission`）来控制按钮的显示/隐藏。

```html
<!-- 只有拥有角色权限控制权限的用户才能看到此按钮 -->
<button v-permission="'auth:manage'">分配角色</button>
```

## 5. 角色预设参考
- **管理员 (`admin`)**: 拥有所有权限键。
- **操作员 (`operator`)**: 拥有除 `auth:manage` 外的所有权限。
- **观察员 (`observer`)**: 仅拥有 `cluster:list`, `cluster:log`, `cluster:op_log`。

---
**版本**: v1.1  
**最后更新**: 2025-12-30
