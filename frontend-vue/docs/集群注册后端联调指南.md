# 集群注册功能后端联调指南

本指南旨在协助后端开发人员对接前端“注册新集群”功能，确保数据结构与数据库 Schema 完全一致。

## 1. 接口信息

- **接口地址**: `/api/v1/clusters`
- **请求方法**: `POST`
- **认证方式**: `Authorization: Bearer <token>` (如果开启了权限校验)

## 2. 请求数据结构 (Payload)

前端发送的 JSON 数据结构如下，字段完全对应数据库 `clusters` 和 `nodes` 表：

```json
{
  "name": "string",          // 集群名称 (对应 clusters.name)
  "type": "hadoop",          // 集群类型 (对应 clusters.type: hadoop, spark, kubernetes)
  "node_count": 5,           // 节点总数 (对应 clusters.node_count)
  "health_status": "unknown",// 健康状态 (对应 clusters.health_status: running, warning, error, unknown)
  "namenode_ip": "string",   // NameNode IP (对应 clusters.namenode_ip)
  "namenode_psw": "string",  // NameNode 密码 (对应 clusters.namenode_psw)
  "rm_ip": "string",         // ResourceManager IP (对应 clusters.rm_ip)
  "rm_psw": "string",        // ResourceManager 密码 (对应 clusters.rm_psw)
  "nodes": [                 // 节点列表 (对应 nodes 表)
    {
      "hostname": "string",    // 节点主机名 (对应 nodes.hostname)
      "ip_address": "string",  // 节点 IP 地址 (对应 nodes.ip_address)
      "ssh_user": "hadoop",    // SSH 用户名 (对应 nodes.ssh_user)
      "ssh_password": "password", // SSH 密码 (对应 nodes.ssh_password)
      "description": "string"  // 节点描述 (对应 nodes.description)
    }
  ]
}
```

## 3. 数据库映射关系

### clusters 表映射
| 前端字段 | 数据库列名 | 类型 | 说明 |
| :--- | :--- | :--- | :--- |
| `name` | `name` | VARCHAR | 集群显示名称 |
| `type` | `type` | VARCHAR | 集群架构类型 |
| `node_count` | `node_count` | INTEGER | 包含的节点数量 |
| `health_status` | `health_status` | VARCHAR | 初始状态，通常为 unknown |
| `namenode_ip` | `namenode_ip` | VARCHAR | HDFS NameNode 地址 |
| `namenode_psw` | `namenode_psw` | VARCHAR | NameNode 凭据 |
| `rm_ip` | `rm_ip` | VARCHAR | YARN RM 地址 |
| `rm_psw` | `rm_psw` | VARCHAR | RM 凭据 |

### nodes 表映射
| 前端字段 | 数据库列名 | 类型 | 说明 |
| :--- | :--- | :--- | :--- |
| `hostname` | `hostname` | VARCHAR | 节点系统主机名 |
| `ip_address` | `ip_address` | VARCHAR | 节点内网/外网 IP |
| `ssh_user` | `ssh_user` | VARCHAR | 远程管理用户 |
| `ssh_password` | `ssh_password` | VARCHAR | 远程管理密码 |
| `description` | `description` | TEXT | 节点备注信息 |

## 4. 响应处理

### 成功响应 (200 OK 或 201 Created)
后端应返回创建成功的集群信息或简单的状态：
```json
{
  "status": "success",
  "message": "集群注册成功",
  "uuid": "generated-uuid-string"
}
```

### 异常响应 (400, 422, 500)
前端已集成详尽的错误解析逻辑，后端建议返回以下结构以获得最佳用户提示：
```json
{
  "detail": {
    "errors": [
      {
        "field": "namenode_ip",
        "message": "IP 格式不正确",
        "step": "参数校验"
      }
    ]
  }
}
```

## 5. 获取列表接口 (GET /api/v1/clusters)
前端展示列表时会请求该接口，请确保返回的 JSON 包含 `clusters` 数组，且字段名与上述 `clusters` 表映射一致。

---
*注：前端代码已对旧字段（如 host, count, ip）做了向下兼容处理，但建议后端优先使用本指南中的新字段名。*
