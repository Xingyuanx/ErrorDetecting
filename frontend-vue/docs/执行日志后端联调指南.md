# 执行日志 (Exec Logs) 后端联调指南

本文档旨在指导后端开发人员如何对接 `frontend-vue` 项目中的“执行日志”页面。该页面已移除所有静态兜底数据，完全依赖后端 API。

## 1. 基础信息

- **页面路径**: `/#/exec-logs`
- **前端组件**: `src/app/views/ExecLogs.vue`
- **基础路径 (Base URL)**: `/api` (由 Vite 代理转发)

---

## 2. 接口定义

### 2.1 获取执行日志列表
用于初始化页面表格及刷新数据。

- **请求方式**: `GET`
- **端点**: `/v1/exec-logs`
- **认证**: 需要在 Header 中携带 `Authorization: Bearer <token>`
- **响应格式 (JSON)**:
  前端支持以下两种结构之一：
  ```json
  {
    "exec_logs": [
      {
        "exec_id": "EXE-001",
        "fault_id": "FLT-001",
        "command_type": "shell",
        "execution_status": "success",
        "start_time": "2025-11-07T10:20:03Z",
        "end_time": "2025-11-07T10:22:35Z",
        "exit_code": 0
      }
    ]
  }
  ```
  或者：
  ```json
  {
    "items": [ ... ]
  }
  ```

### 2.2 新增执行日志
- **请求方式**: `POST`
- **端点**: `/v1/exec-logs`
- **请求体 (JSON)**:
  ```json
  {
    "exec_id": "string",
    "fault_id": "string",
    "command_type": "shell | hdfs | yarn",
    "execution_status": "running | success | failed",
    "start_time": "ISO8601 String",
    "end_time": "ISO8601 String | null",
    "exit_code": "number | null"
  }
  ```

### 2.3 更新执行日志
- **请求方式**: `PUT`
- **端点**: `/v1/exec-logs/{exec_id}`
- **请求体 (JSON)**: 同 POST（不含 `exec_id`）。

### 2.4 删除执行日志
- **请求方式**: `DELETE`
- **端点**: `/v1/exec-logs/{exec_id}`

---

## 3. 注意事项

1. **时间格式**: 后端返回的时间字符串应符合 ISO8601 格式，前端会自动截取前 19 位并替换 `T` 为空格进行展示。
2. **错误处理**: 
   - 如果接口返回非 2xx 状态码，前端会解析 `response.data.detail` 作为错误消息显示在 UI 上。
   - 若无 `detail` 字段，则回退显示 `e.message` 或“网络错误”。
3. **字段映射**: 前端代码中做了容错映射（如 `exec_id` 或 `id`），但建议优先使用 `exec_id` 以保持一致。
4. **状态类型**: `execution_status` 必须是 `running`, `success`, `failed` 之一，否则前端样式可能无法正确渲染。

---

## 4. 联调测试建议

1. 使用 Postman 或 cURL 先行验证 `/api/v1/exec-logs` 是否能正确返回数据。
2. 检查 Vite 配置文件中的代理目标 (`target`) 是否指向了正确的后端服务端口。
3. 确保登录后获取的 Token 已正确存储在 LocalStorage 中，否则请求会因缺少 Header 而失败。
