# 告警配置后端联调指南

本指南旨在说明“告警配置”页面（`AlertConfig.vue`）与后端接口的联调要求。

## 1. 基础信息

- **页面路径**: `/alert-config`
- **组件文件**: `src/app/views/AlertConfig.vue`
- **鉴权要求**: 必须在请求头中携带 `Authorization: Bearer <token>`。

## 2. 接口定义

### 2.1 获取全局告警设置
获取告警级别、通知渠道开关及联系方式。

- **URL**: `/api/v1/alert/settings`
- **方法**: `GET`
- **成功响应 (200 OK)**:
  ```json
  {
    "severity": "INFO",
    "enableEmail": true,
    "enableSms": false,
    "enableWebhook": true,
    "email": "ops@example.com",
    "webhook": "https://hooks.example.com/alert"
  }
  ```

### 2.2 保存全局告警设置
更新全局告警配置。

- **URL**: `/api/v1/alert/settings`
- **方法**: `POST`
- **请求体**:
  ```json
  {
    "severity": "WARN",
    "enableEmail": true,
    "enableSms": false,
    "enableWebhook": true,
    "email": "new-ops@example.com",
    "webhook": "https://hooks.example.com/alert"
  }
  ```

### 2.3 获取告警规则列表
获取所有已定义的告警规则。

- **URL**: `/api/v1/alert/rules`
- **方法**: `GET`
- **成功响应 (200 OK)**:
  ```json
  {
    "rules": [
      {
        "name": "cpu-high-usage",
        "cond": "CPU > 85% 持续 5 分钟",
        "level": "WARN",
        "channel": "邮件"
      }
    ]
  }
  ```

### 2.4 新增或更新告警规则
创建新规则或根据名称更新现有规则。

- **URL**: `/api/v1/alert/rules`
- **方法**: `POST`
- **请求体**:
  ```json
  {
    "name": "node-disconnected",
    "cond": "心跳丢失 3 次",
    "level": "ERROR",
    "channel": "邮件 + Webhook"
  }
  ```

### 2.5 删除告警规则
根据规则名称删除特定规则。

- **URL**: `/api/v1/alert/rules/:name`
- **方法**: `DELETE`
- **路径参数**:
  - `name`: 规则名称（需进行 URL 编码）

## 3. 数据类型说明

### Severity (告警级别)
- `INFO`: 提示
- `WARN`: 警告
- `ERROR`: 严重错误

### Rule 对象
| 字段 | 类型 | 说明 |
| :--- | :--- | :--- |
| name | string | 规则唯一名称 |
| cond | string | 触发条件描述 |
| level | string | 级别 (INFO/WARN/ERROR) |
| channel | string | 通知渠道描述文案 |

## 4. 错误处理

接口应返回标准 HTTP 状态码：
- `401 Unauthorized`: Token 失效或未携带。
- `403 Forbidden`: 当前用户角色无权操作（非管理员/操作员）。
- `422 Unprocessable Entity`: 参数校验失败，需在 `detail` 字段返回错误详情。
  ```json
  { "detail": "规则名称已存在" }
  ```

## 5. 前端代理配置
确保 `vite.config.ts` 中的代理配置正确，以便将 `/api` 请求转发至后端。
```typescript
proxy: {
  "/api": {
    target: "http://localhost:8000",
    changeOrigin: true,
  }
}
```
