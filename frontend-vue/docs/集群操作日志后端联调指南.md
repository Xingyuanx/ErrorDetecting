# 集群操作日志 (Cluster Operation Logs) 后端联调指南

本文档旨在指导后端开发人员如何对接 `frontend-vue` 项目中的“集群操作日志”页面。该页面已根据数据库重构进行了适配，完全依赖后端 API。

## 1. 基础信息

- **页面路径**: `/#/hadoop-exec-logs`
- **前端组件**: `src/app/views/ExecLogs.vue`
- **基础路径 (Base URL)**: `/api` (由 Vite 代理转发)

---

## 2. 接口定义

### 2.1 获取集群操作日志列表

用于初始化页面表格及刷新数据。

- **请求方式**: `GET`
- **端点**: `/v1/exec-logs`
- **认证**: 需要在 Header 中携带 `Authorization: Bearer <token>`
- **响应格式 (JSON)**:
  前端支持以下两种结构之一：
  ```json
  {
    "exec_logs": [
      {
        "id": 1,
        "cluster_name": "hadoop-cluster-01",
        "username": "admin",
        "description": "执行HDFS清理脚本",
        "execution_status": "success",
        "start_time": "2025-11-07T10:20:03Z",
        "end_time": "2025-11-07T10:22:35Z"
      }
    ]
  }
  ```
  或者：
  ```json
  {
    "items": [ ... ],
    "total": 100
  }
  ```

### 2.2 新增集群操作日志

- **请求方式**: `POST`
- **端点**: `/v1/exec-logs`
- **请求体 (JSON)**:
  ```json
  {
    "from_user_id": 1,
    "cluster_name": "string",
    "description": "string",
    "execution_status": "running | success | failed",
    "start_time": "ISO8601 String (e.g., 2023-10-27T10:00:00Z)",
    "end_time": "ISO8601 String | null"
  }
  ```

### 2.3 更新集群操作日志

- **请求方式**: `PUT`
- **端点**: `/v1/exec-logs/{id}`
- **请求体 (JSON)**: 同 POST。

### 2.4 删除集群操作日志

- **请求方式**: `DELETE`
- **端点**: `/v1/exec-logs/{id}`

---

## 3. 注意事项

1. **主键字段**: 主键已由 `exec_id` (String) 统一改为 `id` (Integer)。
2. **新增必填字段**: `from_user_id` (Integer) 和 `cluster_name` (String)。前端会自动从当前登录用户信息中获取 `from_user_id`。
3. **时间格式**: 后端返回的时间字符串应符合 ISO8601 格式，前端展示时会进行格式化。
4. **状态类型**: `execution_status` 必须是 `running`, `success`, `failed` 之一。

---

## 4. 联调测试建议

1. 使用 Postman 验证 `/api/v1/exec-logs`。
2. 确保登录后获取的 Token 包含正确的用户 ID。
