# 基于Hadoop的故障检测与自动恢复项目 前景与范围文档

## 1. 项目愿景
- 构建“采集→处理→诊断→修复→评估”的自动化闭环，降低运维成本、提升稳定性与响应速度。
- 面向多集群、复杂日志场景，提供可视化监控、智能诊断与安全可控的自动修复能力。
- 引入多智能体架构，分别承担日志解析、诊断、修复与风险策略，提升扩展性与可维护性。

## 2. 业务目标
- 实时感知 Hadoop 集群运行状态并发现异常。
- 将结构化日志与历史数据驱动的诊断结果转化为可执行修复指令。
- 在风险可控与审计可追的前提下自动闭环修复。
- 为运维人员提供一站式操作入口与报表能力。

## 3. 目标用户与角色
- 管理员（admin）：系统配置、用户与角色、策略管理、审批。
- 操作员（operator）：查看监控、执行修复、管理故障与执行日志。
- 观察员（observer/viewer）：只读查看监控、日志与报表。

## 4. 使用场景
- 日常巡检：在“仪表板”查看节点健康、趋势与异常指示。
- 故障处理：在“故障中心”查看故障详情，触发诊断与修复，跟踪执行记录。
- 日志分析：在“日志查询”检索多维度日志并提交智能分析。
- 安全合规：针对关键操作记录审计日志，支持导出留存。
- 配置治理：在“告警配置”设置阈值与通知渠道，联动规则执行。

## 5. 项目范围（In/Out）
- In Scope
  - 前端页面（参考 `src/fronted/index.html`）：
    - 集群列表/注册、仪表板监控、日志查询、故障诊断（多智能体原型）、故障中心（CRUD）、执行日志（CRUD）、告警配置（规则管理原型）、用户管理、角色分配、权限策略、审计日志、登录/注册/审批。
  - 后端服务（FastAPI）：日志接收与结构化、集群状态查询、诊断接口、大模型调用、修复执行编排、审计与权限；登录与认证（JWT）。
  - 多智能体编排：DiagnosisAgent、RepairAgent、PolicyAgent、LogParserAgent。
  - 数据存储：PostgreSQL（JSONB/UUID/INET/TIMESTAMPTZ），Redis 缓存与限流。
  - 可观测性：Prometheus 指标采集、Grafana 展示。
- Out of Scope
  - 跨租户计费与合同管理、第三方 CMDB 深度集成、复杂工单系统。
  - 非 Hadoop 生态的深度治理功能（如 Kubernetes 全面管控）。

## 6. 依赖与约束
- 技术栈：FastAPI + SQLAlchemy + asyncpg；PostgreSQL 14+；Redis；Apache Flume；Vue3/Vite/Element Plus/ECharts；WebSocket；Prometheus/Grafana。
- 安全合规：严格的角色/权限/审计与敏感信息管理；禁止在代码与配置中明文保存秘钥。
- 性能约束：常用页面查询 P95 ≤ 500ms；诊断与修复链路端到端 ≤ 5 分钟。

## 7. 风险与应对
- 大模型稳定性：双供应商与重试；PolicyAgent 风险过滤与审批策略。
- 修复脚本风险：分级管控（low/medium/high），高风险需人工审批与备份。
- 日志采集质量：Flume 异常监控与补偿，数据丢失报警与追溯。
- 数据一致性：关键事件事务化与审计留痕；定期备份与恢复演练。

## 8. 里程碑与交付物
- M1 基础环境：集群与存储、前后端骨架、日志采集链路联通。
- M2 核心功能：仪表板、日志查询、故障中心与执行日志 CRUD，诊断接口闭环。
- M3 多智能体：诊断/修复/策略编排，上线审批流与风控策略。
- M4 保障与上线：测试报告、部署与监控面板、运行评估与优化计划。

## 9. 成功度量（KPI）
- 诊断准确率 ≥ 85%；故障闭环时效 ≤ 5 分钟；修复复发率 ≤ 5%。
- 关键页面 P95 响应 ≤ 500ms；错误率 ≤ 1%；WebSocket 在线率 ≥ 99%。
