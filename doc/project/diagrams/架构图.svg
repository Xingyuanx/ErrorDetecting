<?xml version="1.0" encoding="UTF-8"?>
<svg width="1400" height="1000" xmlns="http://www.w3.org/2000/svg" style="background-color: white;">
  <defs>
    <style>
      .title { font-family: 'Microsoft YaHei', sans-serif; font-size: 24px; font-weight: bold; text-anchor: middle; }
      .component-title { font-family: 'Microsoft YaHei', sans-serif; font-size: 14px; font-weight: bold; text-anchor: middle; }
      .component-text { font-family: 'Microsoft YaHei', sans-serif; font-size: 12px; text-anchor: middle; }
      .small-text { font-family: 'Microsoft YaHei', sans-serif; font-size: 10px; }
      .hadoop-cluster { fill: #E8F5E8; stroke: #4CAF50; stroke-width: 3; }
      .component { fill: #E3F2FD; stroke: #1976D2; stroke-width: 2; }
      .database { fill: #FFF3E0; stroke: #FF9800; stroke-width: 2; }
      .queue { fill: #FFEBEE; stroke: #F44336; stroke-width: 2; }
      .cloud { fill: #F3E5F5; stroke: #9C27B0; stroke-width: 2; }
      .frontend { fill: #E0F2F1; stroke: #009688; stroke-width: 2; }
      .llm { fill: #FCE4EC; stroke: #E91E63; stroke-width: 2; }
      .arrow { stroke: #333333; stroke-width: 2; fill: none; marker-end: url(#arrowhead); }
      .bidirectional { stroke: #666666; stroke-width: 2; fill: none; marker-end: url(#arrowhead); marker-start: url(#arrowhead); }
    </style>
    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#333333" />
    </marker>
  </defs>

  <!-- 标题 -->
  <text x="700" y="30" class="title">故障检测系统总体架构</text>

  <!-- Hadoop Cluster -->
  <g id="hadoop-cluster">
    <rect x="50" y="80" width="400" height="250" rx="10" class="hadoop-cluster" />
    <text x="250" y="105" class="component-title">Hadoop Cluster</text>
    
    <!-- NameNode -->
    <rect x="80" y="130" width="120" height="60" rx="5" class="component" />
    <text x="140" y="165" class="component-text">NameNode</text>
    
    <!-- DataNode 1 -->
    <rect x="220" y="130" width="120" height="60" rx="5" class="component" />
    <text x="280" y="165" class="component-text">DataNode</text>
    
    <!-- DataNode 2 -->
    <rect x="220" y="210" width="120" height="60" rx="5" class="component" />
    <text x="280" y="245" class="component-text">DataNode</text>
  </g>

  <!-- Flume Agents -->
  <g id="flume">
    <ellipse cx="250" cy="420" rx="100" ry="50" class="cloud" />
    <text x="250" y="425" class="component-title">Flume Agents</text>
  </g>

  <!-- FastAPI Service -->
  <g id="fastapi">
    <rect x="550" y="350" width="200" height="100" rx="10" class="component" />
    <text x="650" y="405" class="component-title">FastAPI Service</text>
  </g>

  <!-- MySQL Database -->
  <g id="mysql">
    <rect x="850" y="200" width="150" height="80" rx="10" class="database" />
    <text x="925" y="245" class="component-title">MySQL</text>
  </g>

  <!-- Redis Cache -->
  <g id="redis">
    <rect x="850" y="320" width="150" height="80" rx="10" class="queue" />
    <text x="925" y="365" class="component-title">Redis</text>
  </g>

  <!-- LLM Diagnose -->
  <g id="llm">
    <rect x="550" y="550" width="200" height="100" rx="10" class="llm" />
    <text x="650" y="595" class="component-title">LLM Diagnose</text>
    <text x="650" y="615" class="small-text">调用大模型</text>
    <text x="650" y="630" class="small-text">返回FixCommand</text>
  </g>

  <!-- Frontend Web -->
  <g id="frontend">
    <rect x="100" y="550" width="300" height="100" rx="10" class="frontend" />
    <text x="250" y="595" class="component-title">Frontend Web</text>
    <text x="250" y="615" class="small-text">(Vue/React + ECharts)</text>
  </g>

  <!-- 连接线和标签 -->
  <g id="connections">
    <!-- Flume to DataNodes -->
    <line x1="250" y1="370" x2="280" y2="190" class="arrow" />
    <text x="200" y="280" class="small-text">采集HDFS/YARN日志</text>
    
    <line x1="250" y1="370" x2="280" y2="270" class="arrow" />
    <text x="200" y="320" class="small-text">采集HDFS/YARN日志</text>

    <!-- API to Database -->
    <line x1="750" y1="380" x2="850" y2="240" class="bidirectional" />
    <text x="780" y="300" class="small-text">写入/查询故障记录</text>

    <!-- API to Redis -->
    <line x1="750" y1="400" x2="850" y2="360" class="bidirectional" />
    <text x="780" y="380" class="small-text">状态缓存/队列</text>

    <!-- API to LLM -->
    <line x1="650" y1="450" x2="650" y2="550" class="bidirectional" />
    <text x="670" y="500" class="small-text">调用诊断服务</text>

    <!-- Frontend to API -->
    <line x1="400" y1="580" x2="550" y2="420" class="bidirectional" />
    <text x="420" y="480" class="small-text">/api/cluster/status</text>
    <text x="420" y="495" class="small-text">/api/logs/query</text>
    <text x="420" y="510" class="small-text">/api/diagnosis/result</text>
    <text x="420" y="525" class="small-text">/api/repair/execute</text>
    
    <!-- WebSocket connection -->
    <path d="M 400 600 Q 500 520 550 440" stroke="#FF5722" stroke-width="2" fill="none" stroke-dasharray="5,5" marker-end="url(#arrowhead)" />
    <text x="450" y="560" class="small-text" fill="#FF5722">WebSocket推送</text>
    <text x="450" y="575" class="small-text" fill="#FF5722">状态/诊断结果</text>
  </g>

  <!-- 架构说明 -->
  <g id="architecture-notes">
    <rect x="50" y="700" width="1300" height="250" fill="#F5F5F5" stroke="#CCCCCC" stroke-width="1" />
    <text x="60" y="720" class="component-title">架构说明：</text>
    
    <text x="70" y="750" class="component-text">数据采集层：</text>
    <text x="90" y="770" class="small-text">• Flume Agents负责从Hadoop集群各节点采集HDFS和YARN日志</text>
    <text x="90" y="785" class="small-text">• 支持实时日志流处理和结构化数据传输</text>
    
    <text x="70" y="810" class="component-text">服务层：</text>
    <text x="90" y="830" class="small-text">• FastAPI提供RESTful API和WebSocket服务</text>
    <text x="90" y="845" class="small-text">• MySQL存储故障记录、执行日志等持久化数据</text>
    <text x="90" y="860" class="small-text">• Redis提供缓存和消息队列功能</text>
    
    <text x="70" y="885" class="component-text">智能诊断：</text>
    <text x="90" y="905" class="small-text">• 集成大语言模型进行智能故障诊断</text>
    <text x="90" y="920" class="small-text">• 生成结构化的修复命令(FixCommand)</text>
    
    <text x="70" y="945" class="component-text">前端展示：</text>
    <text x="90" y="965" class="small-text">• Vue/React构建的现代化Web界面</text>
    <text x="90" y="980" class="small-text">• ECharts提供丰富的数据可视化功能</text>
  </g>
</svg>