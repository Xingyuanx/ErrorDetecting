# 第十五周个人周计划（李涛）

## 核心目标
- **集群注册功能彻底实现**：在集群注册流程中增加SSH连接远程节点校验环节，仅校验通过的节点允许完成注册，同时精准采集集群UUID并完成持久化存储。
- **集群数据采集功能落地**：通过SSH远程访问主机，完成集群日志采集、CPU及内存信息采集功能的开发、测试与验证，确保数据采集准确且实时。

## 详细计划

### 周一：集群注册流程梳理与SSH校验模块设计
- **任务内容**：
  - 梳理现有集群注册流程，明确SSH连接校验在注册流程中的前置插入节点。
  - 设计SSH连接校验模块，定义校验成功/失败的分支处理逻辑（失败则终止注册并返回标准化错误提示）。
  - 调研集群UUID的采集方案（如读取节点硬件标识文件、调用系统命令生成、采集网卡MAC拼接等），确定最优采集方式。
- **验收标准**：输出修订后的集群注册流程流程图，完成SSH校验模块接口设计文档，明确UUID采集的具体方案与执行命令。

### 周二：SSH校验模块开发与注册流程改造
- **任务内容**：
  - 基于现有`ssh_utils`封装注册专用的SSH连接校验函数`check_ssh_connectivity`，支持超时配置、异常捕获及结果返回。
  - 改造集群注册核心接口，将SSH校验作为注册前置必选步骤，校验失败时终止注册并返回明确错误信息。
  - 开发集群UUID采集函数，在SSH校验通过后自动执行采集逻辑，完成UUID的临时存储。
- **验收标准**：SSH校验失败时注册流程立即终止，校验成功后可正确采集并暂存UUID；校验函数单元测试覆盖率≥90%。

### 周三：集群UUID持久化与注册功能联调
- **任务内容**：
  - 实现集群UUID的持久化存储逻辑，将UUID与集群ID关联后写入数据库/配置文件。
  - 端到端联调集群注册全流程（前端发起注册→后端SSH校验→UUID采集→注册完成→数据落库）。
  - 处理注册边界场景（SSH校验超时、UUID采集失败、多节点注册时部分节点校验失败）。
- **验收标准**：注册全流程闭环无异常，数据库中可查询到注册集群的UUID信息，所有边界场景均有友好错误提示。

### 周四：CPU/内存信息采集功能开发
- **任务内容**：
  - 基于SSH远程执行命令（`free -m`/`top -b -n 1`/`mpstat`等）开发CPU、内存信息采集函数，支持多节点并行采集。
  - 设计采集频率配置项（手动触发/定时采集），统一采集结果的JSON格式化输出结构。
  - 开发采集数据的本地缓存与定时上报逻辑，避免重复采集与数据丢失。
- **验收标准**：通过SSH可精准采集目标主机CPU使用率、内存使用率/空闲量/总容量等核心指标，数据格式统一可解析，采集延迟≤3秒。

### 周五：集群日志采集功能开发与全功能测试
- **任务内容**：
  - 开发SSH远程日志采集函数，支持指定日志文件路径、关键词过滤、按时间范围截取日志内容。
  - 整合CPU/内存采集与日志采集功能，封装为统一的`cluster_collector`集群监控采集接口。
  - 搭建多节点测试集群，完成“注册+数据采集”全流程测试，覆盖弱网、跨网段、不同操作系统（CentOS/Ubuntu）场景。
- **验收标准**：日志采集可精准获取指定内容，CPU/内存数据实时性≤5秒，全流程测试通过率≥95%。

### 周六：周总结与代码优化
- **任务内容**：
  - 整理本周集群注册、数据采集过程中的问题与解决方案，形成技术知识库。
  - 优化SSH连接复用逻辑，提升多节点采集效率；完善代码注释、异常处理及容错机制。
  - 编写集群注册与数据采集功能的使用文档、API接口文档，准备下周演示环境。
- **验收标准**：代码可维护性显著提升，文档覆盖核心功能使用、接口参数及异常排查，演示环境搭建完成。

## 风险与应对
- **风险**：不同操作系统（CentOS/Ubuntu）的CPU/内存命令输出格式差异，导致采集数据解析失败。
  - **应对**：适配主流操作系统的命令输出格式，增加格式自动识别与兼容逻辑；提供自定义解析规则配置项，支持扩展适配新系统。
- **风险**：SSH连接慢/断连导致注册超时、采集数据不完整。
  - **应对**：优化SSH连接超时参数配置，增加采集/校验重试机制；对采集失败的节点标记并触发告警，支持断点续采。
- **风险**：不同集群环境下UUID采集方式不兼容，导致UUID重复或采集失败。
  - **应对**：采用“硬件标识+系统信息+自定义前缀”的多维度方式生成集群唯一UUID，增加UUID唯一性校验逻辑，采集失败时提供人工录入UUID的兜底方案。
