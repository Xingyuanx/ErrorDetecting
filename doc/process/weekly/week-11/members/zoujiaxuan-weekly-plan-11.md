# 邹佳轩第11周详细工作计划（Flume专项）

## 基本信息
- **姓名**: 邹佳轩  
- **计划周期**: 第11周（2025-12-01 至 2025-12-07）  
- **项目**: 基于Hadoop的故障检测与自动恢复项目  
- **计划制定时间**: 2025-12-01  
- **工作时间**: 每天20:00-21:30（1.5小时/天，共10.5小时）

## 本周核心目标（数据采集层：Flume）
- 技术栈聚焦：Apache Flume（Source/Channel/Sink、拦截器、可靠性与性能调优、监控）
- 目标：完成从日志源到 HDFS/Kafka 的端到端采集闭环，形成可复用配置与验证文档。

### 主要任务概览
围绕 Flume 的安装、配置与验证展开：从基础概念与架构，到 HDFS/Kafka Sink 的端到端采集，再到拦截器、可靠性与性能调优、监控与告警。最终输出标准化配置样例、运行脚本与问题清单。

### 核心目标
1. **环境准备与基础概念（周一）**：安装 Flume，理解 Source/Channel/Sink 架构与数据流。
2. **HDFS Sink 端到端采集（周二）**：配置 Spooling/Exec Source → File/Memory Channel → HDFS Sink。
3. **Kafka Sink 验证（周三）**：配置 Kafka Sink，完成到 Kafka 主题的采集与消费验证。
4. **拦截器与事件增强（周四）**：使用 Timestamp/Host/Regex 拦截器进行事件丰富与筛选。
5. **可靠性与性能调优（周五）**：事务批量、Channel 容量、滚动策略与文件切片；故障注入测试。
6. **监控与运维（周六）**：启用 JMX/HTTP 指标，编写运行与巡检脚本，形成告警占位方案。
7. **演示与复盘（周日）**：完成端到端演示与截图，整理问题与对策，输出总结与下周计划。

### 质量目标
- 可靠性：事务提交成功率≥99%，失败自动重试与数据不丢失。
- 性能：单实例吞吐达到预期（示例目标：≥2k events/s，视环境调整）。
- 观测性：关键指标可见（Channel 深度、Sink 成功率、事务耗时等）。
- 文档化：配置样例、运行脚本、验证步骤与常见问题完整可复用。

---

## 周一（2025-12-01）
**主题：Flume安装与基础概念**

### 20:00-21:30：环境与架构
- **学习任务**：安装 Flume；理解 Source/Channel/Sink 的工作机制与数据流。
- **具体方法**：准备示例日志源与最小配置；验证 Agent 启动与日志。
- **产出**：`flume-env.md`（环境与架构理解）、最小配置与启动说明。

---

## 周二（2025-12-02）
**主题：HDFS Sink 端到端采集**

### 20:00-21:30：采集到 HDFS
- **学习任务**：配置 Spooling/Exec Source → File/Memory Channel → HDFS Sink。
- **具体方法**：设置 `hdfs.path`、`hdfs.fileType`、滚动策略与压缩；验证 HDFS 文件生成。
- **产出**：`conf/flume-hdfs.conf`、采集验证截图与说明。

---

## 周三（2025-12-03）
**主题：Kafka Sink 验证**

### 20:00-21:30：采集到 Kafka
- **学习任务**：配置 Kafka Sink，定义主题、批量大小与序列化方式。
- **具体方法**：使用 `kafka-console-consumer` 验证消息；记录端到端延迟与丢失情况。
- **产出**：`conf/flume-kafka.conf`、验证日志与截图。

---

## 周四（2025-12-04）
**主题：拦截器与事件增强**

### 20:00-21:30：事件丰富与筛选
- **学习任务**：Timestamp/Host/Regex 拦截器；添加动态 header；正则过滤无效事件。
- **具体方法**：对比开启/关闭拦截器的事件内容与吞吐影响。
- **产出**：`conf/flume-interceptors.conf`、效果对比记录。

---

## 周五（2025-12-05）
**主题：可靠性与性能调优**

### 20:00-21:30：事务与滚动策略
- **学习任务**：调整 `batchSize`、`capacity`、`transactionCapacity`、`hdfs.rollInterval/Size/Count`。
- **具体方法**：进行故障注入（网络抖动、HDFS不可用、Kafka不可用），观察重试与积压。
- **产出**：`flume-tuning.md`（参数与现象记录）、调优前后对比数据。

---

## 周六（2025-12-06）
**主题：监控与运维**

### 20:00-21:30：指标与脚本
- **学习任务**：启用 JMX/HTTP 指标；编写启动/停止/巡检脚本；制定告警占位方案。
- **具体方法**：采集关键指标（Channel 深度、吞吐、延迟、失败率），形成巡检清单。
- **产出**：`tools/flume-run.ps1`（Windows 脚本）、`flume-monitor.md`（指标与巡检）。

---

## 周日（2025-12-07）
**主题：演示与复盘**

### 20:00-21:30：端到端演示
- **任务**：完成 HDFS/Kafka 双链路演示，整理问题与对策，输出总结与下周计划。
- **产出**：演示记录、测试报告、周报与下周计划草案。

---

## 风险评估与应对策略
- **HDFS 权限与路径问题**：导致写入失败 → 预先创建目录并设置权限；使用测试账户验证。
- **Kafka 集群可用性**：主题不存在或不可用 → 预创建主题，设置副本与分区；本地/远程双验证。
- **资源与端口冲突**：多 Agent/进程冲突 → 统一端口规划与进程巡检脚本。
- **吞吐与积压**：批量与容量不合理 → 通过压力测试与监控数据动态调整参数。

## 学习资源与参考资料
- Flume 官方文档：https://flume.apache.org/  
- HDFS 命令与权限：https://hadoop.apache.org/docs/current/hadoop-project-dist/hadoop-hdfs/HdfsUserGuide.html  
- Kafka 文档：https://kafka.apache.org/documentation/  
- 监控与JMX参考：社区与官方示例

## 预期成果与交付物

### 主要交付物
| 类别 | 交付物 | 具体内容 |
|------|--------|----------|
| **Flume配置** | `conf/flume-hdfs.conf` | Source/Channel/Sink 到 HDFS 的端到端配置 |
| **Flume配置** | `conf/flume-kafka.conf` | 采集到 Kafka 主题的配置与验证 |
| **拦截器** | `conf/flume-interceptors.conf` | Timestamp/Host/Regex 拦截器示例 |
| **调优与验证** | `flume-tuning.md` | 参数、现象与对比数据记录 |
| **监控与脚本** | `tools/flume-run.ps1` | 启停/巡检脚本与指标采集 |
| **验证报告** | `flume-e2e-verify.md` | 端到端演示记录、截图与问题清单 |

### 质量标准
- 可复现：配置与脚本可直接运行，结果稳定可复现  
- 可维护：参数化与路径规范统一，脚本文档清晰  
- 可观测：关键指标有采集与记录，具备基本告警占位  

---
**计划制定时间**: 2025-12-01  
**计划执行周期**: 2025-12-01 至 2025-12-07  
**个人目标**: 跑通 Flume→HDFS/Kafka 的双链路采集闭环，形成标准化配置、调优与监控的可复用能力。

