# 第十三周个人周计划
**核心目标**：完成后端登录注册模块与现有日志采集、Hadoop集群远程控制功能的整合，实现用户认证授权与核心业务功能的协同工作，构建完整的权限可控的日志管理与集群操控系统，为系统安全访问与功能闭环奠定基础
**前置准备**：FastAPI用户认证相关库（passlib、python-jose）、MySQL数据库模型设计工具（SQLAlchemy）、用户权限管理方案文档、现有日志采集/远程控制模块代码、接口测试工具（Postman）、JWT令牌生成与验证工具、密码加密算法（bcrypt）、pytest测试框架

## 周日：登录注册模块架构设计与需求梳理
- 1. 需求分析：明确登录注册功能核心需求（用户注册、登录验证、令牌生成、权限划分），梳理与日志采集/集群控制模块的权限关联（如管理员可操作集群，普通用户仅查看日志）
- 2. 模块架构设计：新增auth/模块（含用户模型、认证逻辑、权限中间件），设计与log_collector/、hadoop_control/模块的调用关系，明确接口权限控制边界
- 3. 数据库表设计：设计users表（字段：id、username、password_hash、role、create_time），添加role字段区分权限（admin/user），建立与日志表的关联查询逻辑
- 4. 技术方案确认：确定基于JWT的认证方案（令牌过期时间、刷新机制），选择bcrypt作为密码加密，制定权限校验中间件的拦截规则

## 周一：用户认证核心功能开发
- 1. 数据模型实现：使用SQLAlchemy定义User模型，映射users表结构，编写用户查询、创建、更新的基础CRUD方法
- 2. 密码加密与验证：集成passlib与bcrypt，实现密码加密存储（生成hash）与登录时的密码校验函数，添加密码强度校验逻辑（长度、复杂度）
- 3. JWT令牌工具开发：封装create_access_token（生成令牌）、verify_token（验证令牌）函数，配置令牌过期时间（2小时）、刷新令牌机制
- 4. 单元测试编写：针对密码加密、令牌生成/验证、用户CRUD方法编写测试用例，pytest测试通过率达100%

## 周二：登录注册接口开发与安全加固
- 1. 注册接口开发：编写POST /api/auth/register接口，实现用户信息校验（用户名唯一性、密码强度）、数据入库逻辑，返回注册结果与用户基本信息（不含密码）
- 2. 登录接口开发：编写POST /api/auth/login接口，接收用户名/密码，验证通过后返回access_token、token_type、用户角色信息
- 3. 安全措施实现：添加接口请求频率限制（防止暴力破解），设置CORS跨域规则，对敏感信息（密码）在日志中脱敏处理
- 4. 接口测试：使用Postman测试注册（重复用户名、弱密码等异常场景）、登录（账号密码错误、成功登录）的响应逻辑，验证令牌生成有效性

## 周三：权限中间件开发与日志采集模块整合
- 1. 权限中间件实现：开发JWT认证中间件，拦截需要权限的接口，验证请求头中的令牌有效性，提取用户角色信息注入请求上下文
- 2. 日志采集接口权限控制：为日志采集相关接口（/api/log/receive、/api/log/query）添加权限校验，限制仅登录用户可访问（role=user/admin）
- 3. 模块调用整合：在日志采集流程中添加用户标识（记录操作人），修改日志存储函数，在hadoop_logs表中新增operator字段关联users表id
- 4. 整合测试：验证未登录用户访问日志接口的拦截效果，测试登录用户操作日志采集的全流程（含操作人记录准确性）

## 周四：远程控制模块权限整合与功能适配
- 1. 集群控制接口权限强化：为Hadoop远程控制接口（/api/hadoop/control）添加角色校验，仅允许admin角色执行启停/状态查询操作
- 2. 操作日志记录：开发操作审计日志功能，记录admin用户对集群的操控行为（操作人、节点IP、指令、时间、结果），存储至hadoop_operation_logs表
- 3. 功能适配：修改远程控制执行逻辑，添加权限不足时的异常响应（code=403，msg="无操作权限"），完善前端提示信息
- 4. 权限边界测试：分别使用user/admin角色测试集群控制接口的访问权限，验证操作日志记录的完整性与准确性

## 周五：模块联调与兼容性测试
- 1. 全流程联调：模拟用户注册→登录→查看日志→admin操控集群的完整场景，验证各模块数据流转（用户信息→权限校验→业务操作→日志记录）的连贯性
- 2. 兼容性测试：检查登录状态下日志采集的实时性（无延迟/丢包），验证令牌过期后接口的重新认证逻辑，测试多用户同时操作的并发兼容性
- 3. 异常场景处理：模拟令牌篡改、权限越界请求、数据库连接失败等异常，验证系统的错误响应与恢复机制
- 4. 联调问题修复：针对联调中发现的权限校验漏洞、模块间数据传递错误等问题，进行代码修复与回归测试

## 周六：综合测试与优化
- 1. 性能压测：模拟多用户并发登录（100+用户/秒）、带权限校验的日志采集（2000+条/秒）场景，测试接口响应时间、数据库负载，优化JWT验证性能
- 2. 安全性加固：通过OWASP安全检查清单，修复潜在风险（如令牌泄露防护、SQL注入防护），完善密码重置功能（邮件验证流程）
- 3. 代码优化：重构重复的权限校验逻辑，提取公共认证工具函数，优化数据库查询语句（添加用户相关字段索引）